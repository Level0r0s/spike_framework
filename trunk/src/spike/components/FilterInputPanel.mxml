<?xml version="1.0" encoding="utf-8"?>
<mx:VBox xmlns:mx="http://www.adobe.com/2006/mxml">
  
  <mx:Script>
    <![CDATA[
      import org.restfulx.collections.ModelsCollection;
      import org.restfulx.Rx;
      import org.restfulx.models.RxModel;
      import com.hurlant.util.der.Integer;
      import mx.controls.TextInput;
      import mx.controls.Label;
      import mx.containers.HBox;
      import mx.states.AddChild;
      import spike.models.AcFilter;
      import mx.controls.Alert;
      import spike.models.AcFilterDef;
    
      public var _filterDef: AcFilterDef;
      
      [Bindable]
      public var results: ModelsCollection;

      public function set filterDef(value: AcFilterDef): void{
        _filterDef = value;
        buildFilterDefPanel(_filterDef);
      }
      
      public function onClickFind(event: MouseEvent): void{
        var i: int;
        var modelClass: Class = getDefinitionByName('stockfin.models.' + _filterDef.modelClass) as Class;
        var params: Object = new Object();

        for (i=0; i<filtersVBox.getChildren().length; i++){
          var renderedFilter: IRenderedFilter = filtersVBox.getChildAt(i) as IRenderedFilter; 
          var fillingValues: Object = renderedFilter.getFillingValues();
          var id: String = renderedFilter.filter.id.toString();
          for (var p:String in fillingValues)
            params['ac_filter_' + id + '_' + p] = fillingValues[p];
          
        }
        Rx.models.reload(modelClass, null, null, null, params);
        
      }
      
      protected function buildFilterDefPanel(filterDef: AcFilterDef): void{
        filtersVBox.removeAllChildren();
        var filter: AcFilter;
        for each(filter in _filterDef.acFilters)
          if (filter.queryUser)
            buildFilter(filter);
      }  
      
      protected function buildFilter(filter: AcFilter): void{
        if (filter.dataType == 'text')
          buildTextFilter(filter);
        if (filter.dataType == 'date')
          buildDateFilter(filter);
        if (filter.dataType == 'autocomplete')
          buildAutocompleteFilter(filter);
        if (filter.dataType == 'checkbox')
          buildCheckboxFilter(filter);
      }
      
      protected function buildTextFilter(filter: AcFilter): void{
        var f: FilterTextInput = new FilterTextInput();
        f.filter = filter;
        filtersVBox.addChild(f);
      }
      
      protected function buildDateFilter(filter: AcFilter): void{
        var f: FilterDateInput = new FilterDateInput();
        f.filter = filter;
        filtersVBox.addChild(f);
      }

      protected function buildAutocompleteFilter(filter: AcFilter): void{
        var f: FilterAutoCompleteInput = new FilterAutoCompleteInput();
        f.filter = filter;
        filtersVBox.addChild(f);
      }

      protected function buildCheckboxFilter(filter: AcFilter): void{
        var f: FilterCheckboxInput = new FilterCheckboxInput();
        f.filter = filter;
        filtersVBox.addChild(f);
      }

    ]]>
  </mx:Script>
  
  <mx:VBox id="filtersVBox" />
  <mx:Button label="Buscar" click="onClickFind(event)" />
  
  
</mx:VBox>
